name: Check Broken Links

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  check-links:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y wget

      - name: Check all links in index.html
        run: |
          # מחפש את כל הלינקים בקובץ ה-HTML
          LINKS=$(grep -oP '(?<=href=")[^"]+' index.html)

          # בודק את הלינקים
          for link in $LINKS; do
            echo "בודק את הלינק: $link"
            STATUS=$(wget --spider --quiet --max-redirect=0 $link 2>&1 | grep "HTTP/" | awk '{print $2}')
            
            if [ "$STATUS" != "200" ]; then
              echo "הנך נתקלת בשגיאה בלינק: $link. סטטוס: $STATUS"
              exit 1
            else
              echo "הלינק $link תקין (סטטוס: 200)"
            fi
          done
          
          echo "כל הלינקים תקינים!"
