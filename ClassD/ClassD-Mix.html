<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>פאזל האלופים V2 - אתגר אקראי!</title>
    <style>
        /* --- General Styles (same as before) --- */
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap');

        :root {
            --primary-color: #ff6b6b; /* New color scheme */
            --success-color: #4ecdc4;
            --error-color: #d0021b;
            --background-color: #f7f9fb;
            --tile-color: #feca57;
            --text-color: #333;
        }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

        .game-container {
            width: 100%;
            max-width: 600px;
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: opacity 0.5s, transform 0.5s;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        p {
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        /* --- Puzzle Grid (same as before) --- */
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 25px;
            border: 5px solid #ff9f43;
            padding: 8px;
            border-radius: 12px;
        }

        .puzzle-piece {
            aspect-ratio: 1 / 1;
            background-color: var(--tile-color);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            color: white;
            font-weight: bold;
            background-image: linear-gradient(135deg, #feca57, #ff9f43);
            cursor: default;
            transition: all 0.6s ease-in-out;
            transform-style: preserve-3d;
            background-size: 300% 300%;
        }

        .puzzle-piece::before { content: '?'; }
        .puzzle-piece.revealed {
            transform: rotateY(180deg);
            background-image: url('https://i.imgur.com/vHqXyT8.jpg'); /* New Image: Space Fox */
            background-color: transparent;
        }
        .puzzle-piece.revealed::before { content: ''; }
        
        /* Positioning for each puzzle piece */
        #piece-0.revealed { background-position: 0% 0%; }
        #piece-1.revealed { background-position: 50% 0%; }
        #piece-2.revealed { background-position: 100% 0%; }
        #piece-3.revealed { background-position: 0% 50%; }
        #piece-4.revealed { background-position: 50% 50%; }
        #piece-5.revealed { background-position: 100% 50%; }
        #piece-6.revealed { background-position: 0% 100%; }
        #piece-7.revealed { background-position: 50% 100%; }
        #piece-8.revealed { background-position: 100% 100%; }

        /* --- Question Area (same as before) --- */
        .question-area {
            padding: 20px;
            background: #fff3e0;
            border-radius: 12px;
        }
        #question-text {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            min-height: 50px;
        }
        .answer-wrapper {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        #answer-input {
            padding: 10px 15px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            font-size: 1.2em;
            text-align: center;
            width: 120px;
            transition: transform 0.2s;
        }
        #submit-btn {
            padding: 10px 25px;
            border: none;
            background-color: var(--primary-color);
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        #submit-btn:hover {
            background-color: #e63946;
            transform: translateY(-2px);
        }

        /* --- Feedback & Final Screen Styles (same as before, adjusted for new colors) --- */
        .correct-flash { animation: flash-green 0.7s ease; }
        @keyframes flash-green {
            0%, 100% { background-color: var(--background-color); }
            50% { background-color: #e0f8f7; }
        }
        .incorrect-shake { animation: shake 0.5s ease; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }
        #feedback-text { margin-top: 10px; font-size: 1.1em; font-weight: bold; height: 25px; }
        #feedback-text.correct { color: var(--success-color); }
        #feedback-text.incorrect { color: var(--error-color); }

        .final-screen { display: none; flex-direction: column; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.95); z-index: 100; padding: 20px; box-sizing: border-box; }
        .final-screen.visible { display: flex; animation: fadeIn 1s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .final-content { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15); max-width: 700px; max-height: 90vh; overflow-y: auto; }
        .final-content h2 { font-size: 3em; color: transparent; background: linear-gradient(45deg, #feca57, #ff6b6b, #4ecdc4); background-clip: text; -webkit-background-clip: text; }
        .final-image { width: 100%; max-width: 400px; border-radius: 15px; margin-bottom: 20px; }
        .final-letter { font-size: 1.2em; line-height: 1.8; text-align: justify; }
        
        .confetti { position: absolute; width: 10px; height: 20px; background-color: #f00; top: -20px; opacity: 0.8; animation: fall 5s linear infinite; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
    </style>
</head>
<body>

    <div id="game-container" class="game-container">
        <h1>פאזל האלופים V2 🚀</h1>
        <p>בכל משחק שאלות חדשות! ענו נכון וגלו את התמונה.</p>
        
        <div class="puzzle-grid" id="puzzle-grid">
             <!-- 9 puzzle pieces will be generated by JS -->
        </div>

        <div class="question-area">
            <div id="question-text">טוען שאלה...</div>
            <div class="answer-wrapper">
                <input type="number" id="answer-input" placeholder="התשובה שלך">
                <button id="submit-btn">בדיקה</button>
            </div>
            <div id="feedback-text"></div>
        </div>
    </div>

    <div id="final-screen" class="final-screen">
        <div id="confetti-container"></div>
        <div class="final-content">
            <h2>🎉 וואו, אתם אסטרונאוטים של חשבון! 🎉</h2>
            <img src="https://i.imgur.com/vHqXyT8.jpg" alt="שועל אסטרונאוט" class="final-image">
            
            <h3>איגרת לכובשי הידע</h3>
            <p class="final-letter">
                כל הכבוד לכם על שהשלמתם את המסע המאתגר הזה!
                <br>
                ראיתם? כל פעם קיבלתם שאלה קצת שונה. לפעמים תרגיל בחשבון יכול להרגיש כמו טיסה לחלל לא נודע, אבל אתם הוכחתם שאתם אמיצים, חכמים ולא מוותרים! בדיוק כמו השועל האסטרונאוט שגיליתם, אתם יצאתם לחקור, חשבתם, ובסוף הצלחתם להרכיב את התמונה השלמה.
                <br><br>
                <strong>החיים והלימודים הם ממש כמו הפאזל הדינמי הזה.</strong>
                <br>
                כל יום מביא איתו אתגרים חדשים ובלתי צפויים. היכולת שלכם לקחת את מה שאתם יודעים ולהתמודד עם בעיה חדשה היא כוח-על אמיתי. כל תרגיל שפתרתם היום חיזק את ה"שריר" הזה במוח שלכם.
                <br><br>
                היכולת לפתור בעיות תפתח לכם בעתיד דלתות לעולמות מופלאים. תוכלו לבנות, להמציא, לחקור ולהגשים כל חלום. כל תרגיל הוא עוד כוכב שאתם מוסיפים לגלקסיה הפרטית שלכם - גלקסיית הידע והכישרון.
                <br><br>
                אז תמשיכו להיות סקרנים כמו חוקרי חלל, תמשיכו לשאול שאלות, ואל תפחדו מאתגרים חדשים. אתם כבר בדרך הנכונה להיות כל מה שתרצו.
                <br><br>
                <strong>עבודה מדהימה, אנחנו גאים בכם עד הירח ובחזרה!</strong>
            </p>
        </div>
    </div>


    <script>
        // --- UTILITY FUNCTIONS ---
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
        }

        // --- QUESTION GENERATORS ---
        const questionGenerators = [
            {
                type: 'חיבור',
                generate: () => {
                    const num1 = randomInt(100, 899);
                    const num2 = randomInt(100, 899);
                    const templates = [
                        `מה הסכום של ${num1} ועוד ${num2}?`,
                        `אם לדניאל יש ${num1} מדבקות והוא קיבל ${num2} נוספות, כמה מדבקות יש לו עכשיו?`,
                        `פתרו את התרגיל: ${num1} + ${num2} = ?`
                    ];
                    return {
                        question: `➕ ${templates[randomInt(0, templates.length - 1)]}`,
                        answer: num1 + num2
                    };
                }
            },
            {
                type: 'חיסור',
                generate: () => {
                    const num1 = randomInt(200, 999);
                    const num2 = randomInt(101, num1 - 50); // Ensure num2 is smaller
                    const templates = [
                        `מה ההפרש בין ${num1} ל-${num2}?`,
                        `לרוני היו ${num1} ש"ח והיא קנתה משחק ב-${num2} ש"ח. כמה כסף נשאר לה?`,
                        `פתרו: ${num1} - ${num2} = ?`
                    ];
                    return {
                        question: `➖ ${templates[randomInt(0, templates.length - 1)]}`,
                        answer: num1 - num2
                    };
                }
            },
            {
                type: 'כפל',
                generate: () => {
                    const num1 = randomInt(2, 12);
                    const num2 = randomInt(10, 50);
                    const templates = [
                        `מהי המכפלה של ${num1} ו-${num2}?`,
                        `בארגז יש ${num2} תפוזים. כמה תפוזים יש ב-${num1} ארגזים כאלה?`,
                        `פתרו את התרגיל: ${num1} × ${num2} = ?`
                    ];
                    return {
                        question: `✖️ ${templates[randomInt(0, templates.length - 1)]}`,
                        answer: num1 * num2
                    };
                }
            },
            {
                type: 'חילוק',
                generate: () => {
                    const answer = randomInt(3, 12);
                    const divisor = randomInt(2, 10);
                    const dividend = answer * divisor;
                    const templates = [
                        `כמה זה ${dividend} לחלק ל-${divisor}?`,
                        `חילקו ${dividend} בלונים שווה בשווה בין ${divisor} ילדים. כמה בלונים קיבל כל ילד?`,
                        `פתרו: ${dividend} ÷ ${divisor} = ?`
                    ];
                    return {
                        question: `➗ ${templates[randomInt(0, templates.length - 1)]}`,
                        answer: answer
                    };
                }
            },
            {
                type: 'שטח',
                generate: () => {
                    const length = randomInt(5, 25);
                    const width = randomInt(4, 15);
                    const templates = [
                        `למגרש מלבני יש אורך של ${length} מ' ורוחב של ${width} מ'. מה שטחו?`,
                        `מהו שטחו של חדר שאורכו ${length} ס"מ ורוחבו ${width} ס"מ?`
                    ];
                     return {
                        question: `🟩 ${templates[randomInt(0, templates.length - 1)]}`,
                        answer: length * width
                    };
                }
            },
            {
                type: 'היקף',
                generate: () => {
                    const length = randomInt(10, 30);
                    const width = randomInt(5, 20);
                    const templates = [
                        `מה ההיקף של גינה מלבנית שאורכה ${length} מ' ורוחבה ${width} מ'?`,
                        `רוצים להקים גדר סביב מגרש שאורכו ${length} מ' ורוחבו ${width} מ'. מה אורך הגדר?`
                    ];
                    return {
                        question: `🏃 ${templates[randomInt(0, templates.length - 1)]}`,
                        answer: 2 * (length + width)
                    };
                }
            },
            {
                type: 'חזקות',
                generate: () => {
                    const base = randomInt(2, 12);
                    const templates = [
                        `כמה זה ${base} בחזקת 2?`,
                        `מה התוצאה של ${base} × ${base}?`,
                        `לריבוע יש צלע באורך ${base}. מה שטחו?`
                    ];
                     return {
                        question: `💪 ${templates[randomInt(0, templates.length - 1)]}`,
                        answer: base * base
                    };
                }
            },
            {
                type: 'סדר פעולות',
                generate: () => {
                    const num1 = randomInt(3, 9);
                    const num2 = randomInt(5, 12);
                    const num3 = randomInt(10, 30);
                    return {
                        question: `🧠 תרגיל מורכב: ${num1} × ${num2} + ${num3} = ?`,
                        answer: (num1 * num2) + num3
                    }
                }
            },
            {
                 type: 'אתגר חילוק וכפל',
                 generate: () => {
                    const num1 = randomInt(20, 50);
                    const num2 = randomInt(2, 5);
                    const num3 = randomInt(2, 5);
                    const answer = (num1 * num2) / num3;
                    // Ensure a whole number answer
                    if ( (num1 * num2) % num3 !== 0) {
                        return this.generate(); // Rerun if not a whole number
                    }
                    return {
                        question: `🏆 אתגר אחרון: (${num1} × ${num2}) ÷ ${num3} = ?`,
                        answer
                    }
                 }
            }
        ];

        // --- GAME LOGIC ---
        let currentQuestionIndex = 0;
        let currentAnswer = 0;
        let shuffledGenerators = [];

        const questionTextEl = document.getElementById('question-text');
        const answerInputEl = document.getElementById('answer-input');
        const submitBtn = document.getElementById('submit-btn');
        const puzzleGrid = document.getElementById('puzzle-grid');
        const feedbackTextEl = document.getElementById('feedback-text');
        const bodyEl = document.querySelector('body');
        const gameContainerEl = document.getElementById('game-container');
        const finalScreenEl = document.getElementById('final-screen');

        function initGame() {
            // Create puzzle pieces
            puzzleGrid.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.id = `piece-${i}`;
                puzzleGrid.appendChild(piece);
            }
            // Shuffle and start
            shuffledGenerators = [...questionGenerators];
            shuffleArray(shuffledGenerators);
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex < shuffledGenerators.length) {
                const generator = shuffledGenerators[currentQuestionIndex];
                const questionData = generator.generate();
                
                currentAnswer = questionData.answer;
                questionTextEl.innerHTML = questionData.question;
                
                answerInputEl.value = '';
                answerInputEl.focus();
                feedbackTextEl.textContent = '';
                feedbackTextEl.className = '';
            } else {
                endGame();
            }
        }

        function checkAnswer() {
            const userAnswer = parseInt(answerInputEl.value);
            if (isNaN(userAnswer)) {
                feedbackTextEl.textContent = 'יש להזין מספר!';
                feedbackTextEl.className = 'incorrect';
                answerInputEl.classList.add('incorrect-shake');
                setTimeout(() => answerInputEl.classList.remove('incorrect-shake'), 500);
                return;
            }

            if (userAnswer === currentAnswer) {
                // Correct Answer
                feedbackTextEl.textContent = 'מעולה! תשובה נכונה! ✨';
                feedbackTextEl.className = 'correct';
                bodyEl.classList.add('correct-flash');
                document.getElementById(`piece-${currentQuestionIndex}`).classList.add('revealed');
                
                currentQuestionIndex++;
                
                setTimeout(() => {
                    bodyEl.classList.remove('correct-flash');
                    displayQuestion();
                }, 1500);

            } else {
                // Incorrect Answer
                feedbackTextEl.textContent = 'אוי, זו לא התשובה. נסו שוב!';
                feedbackTextEl.className = 'incorrect';
                answerInputEl.classList.add('incorrect-shake');
                setTimeout(() => answerInputEl.classList.remove('incorrect-shake'), 500);
            }
        }

        function endGame() {
             gameContainerEl.style.opacity = '0';
             gameContainerEl.style.transform = 'scale(0.8)';
             setTimeout(() => {
                gameContainerEl.style.display = 'none';
                finalScreenEl.classList.add('visible');
                launchConfetti();
             }, 500);
        }
        
        function launchConfetti() {
            const confettiContainer = document.getElementById('confetti-container');
            const colors = ['#ff6b6b', '#4ecdc4', '#feca57', '#1dd1a1', '#ff9f43'];
            if(confettiContainer.children.length > 0) return; // Prevent multiple launches
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 5 + 's';
                confetti.style.width = (Math.random() * 8 + 5) + 'px';
                confetti.style.height = (Math.random() * 15 + 10) + 'px';
                confettiContainer.appendChild(confetti);
            }
        }

        submitBtn.addEventListener('click', checkAnswer);
        answerInputEl.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        });

        // Start the game
        initGame();
    </script>
</body>
</html>