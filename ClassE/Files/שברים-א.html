<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×œ×•××“×ª ×©×‘×¨×™× ×œ×›×™×ª×” ×”' â€“ ×–×™×”×•×™, ×—×™×‘×•×¨ ×•×—×™×¡×•×¨ ğŸŒŸ</title>
    <style>
        body { 
            font-family: 'Arial', sans-serif; 
            background: linear-gradient(to bottom, #e0f7fa, #ffffff); 
            margin: 0; padding: 20px; 
            text-align: center; 
        }
        h1 { color: #006064; margin-bottom: 10px; }
        p.intro { font-size: 1.2em; color: #00796b; margin-bottom: 30px; }
        .question { 
            background: white; 
            border-radius: 20px; 
            padding: 25px; 
            margin: 30px auto; 
            max-width: 700px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); 
        }
        .canvases { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; margin: 20px 0; align-items: center; }
        canvas { 
            border: 3px solid #0097a7; 
            border-radius: 50%; 
            background: #fff; 
        }
        .text { font-size: 1.3em; color: #004d40; margin: 15px 0; }
        .math-sign { font-size: 2em; font-weight: bold; color: #ff5722; margin: 0 20px; }
        
        button.check-btn { 
            background: #ff5722; color: white; border: none; padding: 12px 25px; 
            font-size: 1.2em; border-radius: 10px; cursor: pointer; margin-top: 15px; 
        }
        button.check-btn:hover { background: #e64a19; }
        button.check-btn.correct-btn { background: #2e7d32; }
        button.check-btn.correct-btn:hover { background: #1b5e20; }
        button.check-btn:disabled { background: #9e9e9e; cursor: not-allowed; }

        .feedback { font-size: 1.4em; margin-top: 20px; font-weight: bold; min-height: 50px; }
        .correct { color: #2e7d32; }
        .incorrect { color: #c62828; }
        #reload { margin: 40px; }
        #reload button { background: #9c27b0; font-size: 1.3em; padding: 15px 30px; }
        #reload button:hover { background: #7b1fa2; }

        .fraction-display, .fraction-input {
            display: inline-block;
            text-align: center;
            font-size: 1.6em;
            margin: 0 10px;
            vertical-align: middle;
        }
        .fraction-display .num, .fraction-input .num input {
            border-bottom: 3px solid #000;
            padding: 5px 10px;
        }
        .fraction-display .den, .fraction-input .den input {
            padding: 5px 10px;
        }
        .fraction-input .num input, .fraction-input .den input {
            width: 60px;
            font-size: 1em;
            text-align: center;
            border: 2px solid #00bcd4;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <h1>×œ×•××“×ª ×©×‘×¨×™× ×œ×›×™×ª×” ×”' ğŸŒŸ</h1>
    <p class="intro">
        ×ª×¨×’×œ×™ ×©×‘×¨×™× ×‘×¦×•×¨×” ×›×™×¤×™×ª ×•××’×•×•× ×ª!<br>
        ×¡×•×’×™ ×©××œ×•×ª: <br>
        â€¢ ×–×™×”×•×™ ×©×‘×¨ ××¦×•×™×¨ (×‘×¢×™×’×•×œ â€“ ×›××• ×¤×™×¦×”!)<br>
        â€¢ ×—×™×‘×•×¨ ×©×‘×¨×™× (+)<br>
        â€¢ ×—×™×¡×•×¨ ×©×‘×¨×™× (âˆ’)<br>
        ×‘×›×œ ×˜×¢×™× ×” ×©×œ ×”×“×£ ×™×•×¤×™×¢×• 5 ×©××œ×•×ª ×—×“×©×•×ª!
    </p>

    <div id="questions"></div>

    <div id="reload">
        <button onclick="location.reload()">×©××œ×•×ª ×—×“×©×•×ª! ğŸ”„</button>
    </div>

    <script>
        const NUM_QUESTIONS = 5;
        let correctAnswers = {};

        function generateQuestions() {
            const container = document.getElementById('questions');
            container.innerHTML = '';
            correctAnswers = {};

            for (let i = 1; i <= NUM_QUESTIONS; i++) {
                const types = ['identify', 'add', 'subtract'];
                const weights = [0.4, 0.3, 0.3];
                const rnd = Math.random();
                let type;
                if (rnd < weights[0]) type = 'identify';
                else if (rnd < weights[0] + weights[1]) type = 'add';
                else type = 'subtract';

                if (type === 'identify') {
                    createIdentificationQuestion(i);
                } else if (type === 'add') {
                    createOperationQuestion(i, '+');
                } else {
                    createOperationQuestion(i, 'âˆ’');
                }
            }
        }

        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }

        function reduceFraction(num, den) {
            if (num === 0) return { num: 0, den: 1 };
            const divisor = gcd(Math.abs(num), den);
            return { num: num / divisor, den: den / divisor };
        }

        function createFractionHTML(num, den) {
            return `<div class="fraction-display">
                        <div class="num">${num}</div>
                        <div class="den">${den}</div>
                    </div>`;
        }

        function createFractionInput(qNum) {
            return `<div class="fraction-input">
                        <div class="num"><input type="text" id="num${qNum}" maxlength="3"></div>
                        <div class="den"><input type="text" id="den${qNum}" maxlength="3"></div>
                    </div>`;
        }

        function createIdentificationQuestion(qNum) {
            let denominator = Math.floor(Math.random() * 11) + 2; // 2-12
            let numerator = Math.floor(Math.random() * (denominator - 1)) + 1;

            const { num: reducedNum, den: reducedDen } = reduceFraction(numerator, denominator);
            const correctHTML = createFractionHTML(reducedNum, reducedDen);

            correctAnswers[qNum] = { num: reducedNum, den: reducedDen, html: correctHTML };

            const div = document.createElement('div');
            div.className = 'question';
            div.innerHTML = `
                <h2>×©××œ×” ${qNum}</h2>
                <div class="text">×›××” ×–×” ×”×©×‘×¨ ×”×¦×‘×•×¢?<br>(×”×–×™× ×™ ××ª ×”××•× ×” ×•×”××›× ×” ×‘×¦×•×¨×” ××•×§×˜× ×ª)</div>
                <canvas id="canvas${qNum}" width="300" height="300"></canvas>
                <div style="margin: 20px 0;">${createFractionInput(qNum)}</div>
                <button class="check-btn" id="btn${qNum}">×‘×“×•×§</button>
                <div id="feedback${qNum}" class="feedback"></div>
            `;
            document.getElementById('questions').appendChild(div);

            drawCircleFraction(`canvas${qNum}`, numerator, denominator);

            document.getElementById(`btn${qNum}`).addEventListener('click', () => checkFractionAnswer(qNum));
        }

        function createOperationQuestion(qNum, operation) {
            let den1 = Math.floor(Math.random() * 9) + 2;
            let num1 = Math.floor(Math.random() * den1);
            let den2 = Math.floor(Math.random() * 9) + 2;
            let num2 = Math.floor(Math.random() * den2);

            // 80% ××”××§×¨×™× ××›× ×™× ×©×•× ×™×
            if (Math.random() > 0.8) den2 = den1;

            let resultNum, resultDen;
            if (operation === '+') {
                resultNum = num1 * den2 + num2 * den1;
                resultDen = den1 * den2;
            } else {
                resultNum = num1 * den2 - num2 * den1;
                resultDen = den1 * den2;
                if (resultNum < 0) {
                    [num1, num2] = [num2, num1];
                    [den1, den2] = [den2, den1];
                    resultNum = -resultNum;
                }
            }

            const { num: reducedNum, den: reducedDen } = reduceFraction(resultNum, resultDen);
            const correctHTML = createFractionHTML(reducedNum, reducedDen);

            // ×‘×“×™×§×” ×× ×™×© ×¦×•×¨×š ×‘×ª×©×•×‘×” ××¢×•×¨×‘×ª
            let mixed = null;
            if (reducedNum > reducedDen) {
                const whole = Math.floor(reducedNum / reducedDen);
                const remainNum = reducedNum % reducedDen;
                mixed = { whole, num: remainNum, den: reducedDen };
            }

            correctAnswers[qNum] = { num: reducedNum, den: reducedDen, html: correctHTML, mixed };

            const opSign = operation === '+' ? '+' : 'âˆ’';

            let mixedInputHTML = '';
            if (mixed && mixed.num !== 0) {
                mixedInputHTML = `
                    <div style="margin: 10px 0 0 0; font-size:1em;">
                        ××• ×›×ª×©×•×‘×” ××¢×•×¨×‘×ª:
                        <div class="fraction-input">
                            <span style="font-size:1.2em;">×©×œ×:</span>
                            <input type="text" id="whole${qNum}" maxlength="3" style="width:40px;">
                            <span style="font-size:1.2em;">×•×©×‘×¨:</span>
                            <div class="num"><input type="text" id="mixnum${qNum}" maxlength="3"></div>
                            <div class="den"><input type="text" id="mixden${qNum}" maxlength="3"></div>
                        </div>
                    </div>
                `;
            }

            const div = document.createElement('div');
            div.className = 'question';
            div.innerHTML = `
                <h2>×©××œ×” ${qNum}</h2>
                <div class="text">×—×©×‘×™ ××ª ×”×ª×•×¦××” (×‘×¦×•×¨×” ××•×§×˜× ×ª):</div>
                <div class="canvases">
                    <div>
                        <canvas id="canvasLeft${qNum}" width="250" height="250"></canvas>
                        <p style="font-size:1.4em; margin:10px;">${createFractionHTML(num1, den1)}</p>
                    </div>
                    <div class="math-sign">${opSign}</div>
                    <div>
                        <canvas id="canvasRight${qNum}" width="250" height="250"></canvas>
                        <p style="font-size:1.4em; margin:10px;">${createFractionHTML(num2, den2)}</p>
                    </div>
                </div>
                <div style="margin: 20px 0;">${createFractionInput(qNum)}</div>
                ${mixedInputHTML}
                <button class="check-btn" id="btn${qNum}">×‘×“×•×§</button>
                <div id="feedback${qNum}" class="feedback"></div>
            `;
            document.getElementById('questions').appendChild(div);

            drawCircleFraction(`canvasLeft${qNum}`, num1, den1);
            drawCircleFraction(`canvasRight${qNum}`, num2, den2);

            document.getElementById(`btn${qNum}`).addEventListener('click', () => checkFractionAnswer(qNum));
        }

        function drawCircleFraction(canvasId, num, den) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const size = Math.min(canvas.width, canvas.height) / 2 - 10;

            ctx.strokeStyle = '#006064';
            ctx.lineWidth = 4;

            for (let i = 0; i < num; i++) {
                const angle1 = (i / den) * 2 * Math.PI - Math.PI / 2;
                const angle2 = ((i + 1) / den) * 2 * Math.PI - Math.PI / 2;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX + size * Math.cos(angle1), centerY + size * Math.sin(angle1));
                ctx.arc(centerX, centerY, size, angle1, angle2);
                ctx.closePath();
                ctx.fillStyle = '#ff9800';
                ctx.fill();
                ctx.stroke();
            }

            for (let i = num; i < den; i++) {
                const angle1 = (i / den) * 2 * Math.PI - Math.PI / 2;
                const angle2 = ((i + 1) / den) * 2 * Math.PI - Math.PI / 2;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX + size * Math.cos(angle1), centerY + size * Math.sin(angle1));
                ctx.arc(centerX, centerY, size, angle1, angle2);
                ctx.closePath();
                ctx.stroke();
            }

            ctx.beginPath();
            ctx.arc(centerX, centerY, size, 0, 2 * Math.PI);
            ctx.stroke();
        }

        function checkFractionAnswer(qNum) {
            const numInput = document.getElementById(`num${qNum}`);
            const denInput = document.getElementById(`den${qNum}`);
            const feedback = document.getElementById(`feedback${qNum}`);
            const button = document.getElementById(`btn${qNum}`);

            const userNumStr = numInput.value.trim();
            const userDenStr = denInput.value.trim();

            let isCorrect = false;
            const correct = correctAnswers[qNum];

            // ×‘×“×™×§×ª ×ª×©×•×‘×” ×¨×’×™×œ×”
            if (userNumStr !== '' && userDenStr !== '') {
                const userNum = parseInt(userNumStr, 10);
                const userDen = parseInt(userDenStr, 10);
                if (!isNaN(userNum) && !isNaN(userDen) && userDen !== 0) {
                    if (userNum === correct.num && userDen === correct.den) isCorrect = true;
                }
            }

            // ×‘×“×™×§×ª ×ª×©×•×‘×” ××¢×•×¨×‘×ª (×× ×™×©)
            if (!isCorrect && correct.mixed && correct.mixed.num !== 0) {
                const wholeInput = document.getElementById(`whole${qNum}`);
                const mixNumInput = document.getElementById(`mixnum${qNum}`);
                const mixDenInput = document.getElementById(`mixden${qNum}`);
                if (wholeInput && mixNumInput && mixDenInput) {
                    const w = parseInt(wholeInput.value.trim(), 10);
                    const n = parseInt(mixNumInput.value.trim(), 10);
                    const d = parseInt(mixDenInput.value.trim(), 10);
                    if (!isNaN(w) && !isNaN(n) && !isNaN(d) && d !== 0) {
                        if (w === correct.mixed.whole && n === correct.mixed.num && d === correct.mixed.den) isCorrect = true;
                    }
                }
            }

            if (isCorrect) {
                feedback.innerHTML = '×›×œ ×”×›×‘×•×“! × ×›×•×Ÿ ×œ×’××¨×™! ğŸ‰âœ…';
                feedback.className = 'feedback correct';
                button.textContent = '× ×›×•×Ÿ! âœ…';
                button.classList.add('correct-btn');
                button.disabled = true;
                numInput.disabled = true;
                denInput.disabled = true;
                if (correct.mixed && correct.mixed.num !== 0) {
                    document.getElementById(`whole${qNum}`).disabled = true;
                    document.getElementById(`mixnum${qNum}`).disabled = true;
                    document.getElementById(`mixden${qNum}`).disabled = true;
                }
            } else {
                feedback.innerHTML = `×œ× ×‘×“×™×•×§... ×”×ª×©×•×‘×” ×”× ×›×•× ×” ×”×™× ${correct.html}${correct.mixed && correct.mixed.num !== 0 ? ` ××• ${correct.mixed.whole} ${createFractionHTML(correct.mixed.num, correct.mixed.den)}` : ''}. × ×¡×™ ×©×•×‘! ğŸ’ª`;
                feedback.className = 'feedback incorrect';
            }
        }

        generateQuestions();
    </script>
</body>
</html>
